{
  "metadata": {
    "title": "Cashier Panel Rebuild - Execution Roadmap",
    "version": "1.0",
    "date": "2025-01-02",
    "status": "planning",
    "totalPhases": 6,
    "estimatedDays": "11-16 days",
    "reference": "Cashier Analysis Report (Part 1 & Part 2)"
  },
  "phases": [
    {
      "id": "Phase A",
      "title": "إصلاح الصلاحيات (Permissions Fix)",
      "priority": "critical",
      "status": "pending",
      "estimatedDays": "1-2 days",
      "goals": [
        "إصلاح مشكلة الصلاحيات في الفواتير",
        "السماح للبائع برؤية وطباعة فواتيره فقط",
        "منع الوصول لفواتير الآخرين"
      ],
      "affectedPages": [
        "/cashier/invoices",
        "API: /api/invoices/[id]",
        "API: /api/invoices/[id]/pdf"
      ],
      "changes": [
        "تعديل GET /api/invoices/[id] لدعم requireCashier مع فحص الملكية",
        "تعديل GET /api/invoices/[id]/pdf لدعم requireCashier مع فحص الملكية",
        "إضافة validation: invoice.cashier === currentUser.id"
      ],
      "whyImportant": "بدون هذا الإصلاح، البائع لا يستطيع القيام بعمله الأساسي (طباعة الفاتورة). هذه وظيفة حرجة جداً (90% من استخدام البائع للفواتير).",
      "riskIfNotDone": {
        "level": "high",
        "description": "البائع لا يستطيع إتمام عمله. التجار سيضطرون لاستخدام حساب المدير للطباعة. مشاكل أمنية (وصول غير مراقب لحساب المدير)."
      },
      "tasks": [
        {
          "id": "A-1",
          "description": "تحليل الكود الحالي لـ /api/invoices/[id] و /api/invoices/[id]/pdf",
          "type": "analysis",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "A-2",
          "description": "إضافة فحص الملكية للبائع (invoice.cashier === currentUser.id)",
          "type": "backend",
          "riskLevel": "high",
          "dependencies": ["A-1"]
        },
        {
          "id": "A-3",
          "description": "اختبار الصلاحيات بعد التعديل (البائع يرى فواتيره فقط)",
          "type": "testing",
          "riskLevel": "high",
          "dependencies": ["A-2"]
        },
        {
          "id": "A-4",
          "description": "تحديث الواجهة الأمامية لاستخدام الـ endpoints (إذا لزم)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": ["A-2"]
        }
      ]
    },
    {
      "id": "Phase B",
      "title": "تبسيط Navigation",
      "priority": "important",
      "status": "pending",
      "estimatedDays": "0.5 days",
      "goals": [
        "تقليل عدد الصفحات غير الضرورية",
        "تبسيط القائمة",
        "تحسين التنقل"
      ],
      "affectedPages": [
        "CashierNavigation.js",
        "/cashier/sales (سيتم حذفها من Navigation)"
      ],
      "changes": [
        "حذف صفحة /cashier/sales من Navigation",
        "الاحتفاظ بـ 3 خيارات فقط: Vente rapide, Résumé quotidien, Mes factures",
        "ترتيب القائمة الجديد"
      ],
      "whyImportant": "تقليل التشتت والارتباك. التركيز على المهام الأساسية. تقليل عدد النقرات.",
      "riskIfNotDone": {
        "level": "medium",
        "description": "استمرار التشتت والارتباك. صعوبة في العثور على المهام الأساسية. وقت أطول لإتمام العمليات."
      },
      "tasks": [
        {
          "id": "B-1",
          "description": "حذف صفحة /cashier/sales من Navigation",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "B-2",
          "description": "تحديث CashierNavigation.js ليعرض 3 خيارات فقط",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": ["B-1"]
        },
        {
          "id": "B-3",
          "description": "تحديث أي روابط داخلية تشير لصفحة المبيعات",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": ["B-1"]
        },
        {
          "id": "B-4",
          "description": "اختبار Navigation الجديد",
          "type": "testing",
          "riskLevel": "low",
          "dependencies": ["B-2", "B-3"]
        }
      ]
    },
    {
      "id": "Phase C",
      "title": "إعادة بناء صفحة البيع (/cashier)",
      "priority": "critical",
      "status": "pending",
      "estimatedDays": "3-4 days",
      "goals": [
        "إضافة عرض واضح لمعلومات الضمان",
        "تحسين عرض المخزون",
        "إضافة validation فوري",
        "تحسين رسالة النجاح",
        "إضافة روابط سريعة للطباعة"
      ],
      "affectedPages": [
        "/cashier/page.js",
        "/cashier/FastSellingClient.js",
        "components/domain/sale/*"
      ],
      "changes": [
        "إضافة Badge الضمان في نتائج البحث",
        "إضافة قسم الضمان في نموذج البيع",
        "تحسين عرض المخزون (في البحث والنموذج)",
        "إضافة validation فوري",
        "تحسين رسالة النجاح مع روابط سريعة",
        "إضافة حساب تلقائي للمبلغ",
        "إضافة تنبيهات (مخزون منخفض، سعر أقل من الشراء)"
      ],
      "whyImportant": "صفحة البيع = 90% من عمل البائع. أي تحسين هنا يؤثر مباشرة على الإنتاجية. منع الأخطاء = توفير مال.",
      "riskIfNotDone": {
        "level": "high",
        "description": "استمرار الأخطاء في البيع. ضياع وقت في الحسابات اليدوية. عميل غاضب بسبب عدم وضوح الضمان."
      },
      "tasks": [
        {
          "id": "C-1",
          "description": "إضافة عرض معلومات الضمان في نتائج البحث (Badge ملون)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "C-2",
          "description": "إضافة قسم الضمان في نموذج البيع (مع تنبيه)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "C-3",
          "description": "تحسين عرض المخزون (في البحث والنموذج) + منع كمية > المخزون",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "C-4",
          "description": "إضافة validation فوري (أثناء الكتابة)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "C-5",
          "description": "تحسين رسالة النجاح مع روابط سريعة (طباعة + بيع جديد)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "C-6",
          "description": "إضافة حساب تلقائي للمبلغ (quantity × price)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "C-7",
          "description": "إضافة تنبيهات (مخزون منخفض، سعر أقل من الشراء)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "C-8",
          "description": "اختبار جميع السيناريوهات (بيع ناجح، أخطاء، validation)",
          "type": "testing",
          "riskLevel": "high",
          "dependencies": ["C-1", "C-2", "C-3", "C-4", "C-5", "C-6", "C-7"]
        }
      ]
    },
    {
      "id": "Phase D",
      "title": "صفحة الفواتير (/cashier/invoices)",
      "priority": "important",
      "status": "pending",
      "estimatedDays": "2-3 days",
      "goals": [
        "تبسيط الفلاتر (حذف غير الضروري)",
        "تحسين عرض معلومات الضمان",
        "تحسين عرض الحالات",
        "إصلاح الأزرار (بعد Phase A)",
        "إضافة تحذيرات للحالات الخاصة"
      ],
      "affectedPages": [
        "/cashier/invoices/page.js",
        "/cashier/invoices/CashierInvoicesPageClient.js",
        "/cashier/invoices/CashierInvoiceTable.js"
      ],
      "changes": [
        "حذف الفلاتر غير الضرورية (warrantyStatus, status, startDate, endDate)",
        "الاحتفاظ فقط بالبحث (q)",
        "تحسين عرض معلومات الضمان (Badge + tooltip)",
        "تحسين عرض الحالات (Badge ملون بالفرنسية)",
        "إصلاح الأزرار (بعد Phase A)",
        "إضافة تحذيرات للحالات الخاصة (ملغاة/مرتجعة)",
        "حذف المعلومات التقنية"
      ],
      "whyImportant": "البائع يحتاج فقط: البحث + الطباعة. الفلاتر المعقدة تشتت ولا تضيف قيمة. المعلومات المالية عبر التاريخ غير مرغوب فيها.",
      "riskIfNotDone": {
        "level": "medium",
        "description": "استمرار التشتت. كشف معلومات مالية غير مرغوب فيها. صعوبة في العثور على الفاتورة المطلوبة."
      },
      "tasks": [
        {
          "id": "D-1",
          "description": "حذف الفلاتر غير الضرورية (warrantyStatus, status, dates)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "D-2",
          "description": "تحسين عرض معلومات الضمان (Badge ملون + tooltip عند hover)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "D-3",
          "description": "تحسين عرض الحالات (Badge ملون بالفرنسية: نشطة/ملغاة/مرتجعة)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "D-4",
          "description": "إصلاح الأزرار (عرض/طباعة/PDF) - يعتمد على Phase A",
          "type": "frontend",
          "riskLevel": "high",
          "dependencies": ["Phase A"]
        },
        {
          "id": "D-5",
          "description": "إضافة تحذيرات للحالات الخاصة (ملغاة/مرتجعة) + منع الطباعة",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "D-6",
          "description": "حذف المعلومات التقنية (IDs, codes)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "D-7",
          "description": "اختبار البحث والطباعة",
          "type": "testing",
          "riskLevel": "high",
          "dependencies": ["D-4"]
        }
      ]
    },
    {
      "id": "Phase E",
      "title": "الملخص اليومي (/cashier/daily-summary)",
      "priority": "important",
      "status": "pending",
      "estimatedDays": "2-3 days",
      "goals": [
        "حساب ذكي للمبلغ الإجمالي (يستثني الملغاة والمرتجعة)",
        "عرض فقط العمليات الناجحة",
        "إضافة رابط للفاتورة من كل عملية",
        "إضافة زر طباعة الملخص"
      ],
      "affectedPages": [
        "/cashier/daily-summary/page.js",
        "/cashier/daily-summary/DailySummaryClient.js",
        "API: /api/sales/my-sales/statistics"
      ],
      "changes": [
        "تعديل API query لاستثناء الملغاة والمرتجعة",
        "تعديل حساب المبلغ الإجمالي (فقط النشطة)",
        "تحديث قائمة المبيعات (فقط النشطة + رابط للفاتورة)",
        "إضافة زر طباعة الملخص (PDF)",
        "تحسين الرسائل والتوضيحات"
      ],
      "whyImportant": "هذا هو المبلغ الفعلي الذي يجب أن يسلمه البائع. التجار لا يريدون المبالغ الملغاة أو المرتجعة في الحساب. وضوح للمحاسبة.",
      "riskIfNotDone": {
        "level": "medium",
        "description": "خلط في المحاسبة. البائع قد يدفع مبلغ خاطئ. مشاكل مالية."
      },
      "tasks": [
        {
          "id": "E-1",
          "description": "تعديل API query لاستثناء الملغاة والمرتجعة (status: active فقط)",
          "type": "backend",
          "riskLevel": "high",
          "dependencies": []
        },
        {
          "id": "E-2",
          "description": "تعديل حساب المبلغ الإجمالي (فقط المبيعات النشطة)",
          "type": "backend",
          "riskLevel": "high",
          "dependencies": ["E-1"]
        },
        {
          "id": "E-3",
          "description": "تحديث قائمة المبيعات (فقط النشطة + رابط للفاتورة)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": ["E-1"]
        },
        {
          "id": "E-4",
          "description": "إضافة زر طباعة الملخص اليومي (PDF)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "E-5",
          "description": "تحسين الرسائل والتوضيحات (يستثني الملغاة والمرتجعة)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": ["E-2"]
        },
        {
          "id": "E-6",
          "description": "اختبار الحسابات (تأكيد استثناء الملغاة/المرتجعة)",
          "type": "testing",
          "riskLevel": "high",
          "dependencies": ["E-2", "E-3"]
        }
      ]
    },
    {
      "id": "Phase F",
      "title": "الطباعة و PDF",
      "priority": "critical",
      "status": "pending",
      "estimatedDays": "2-3 days",
      "goals": [
        "تحسين تجربة الطباعة بعد البيع",
        "إصلاح أزرار الطباعة في صفحة الفواتير",
        "إضافة طباعة الملخص اليومي",
        "تحسين PDF نفسه (معلومات الضمان)"
      ],
      "affectedPages": [
        "جميع صفحات البائع (البيع، الفواتير، الملخص)",
        "API: /api/invoices/[id]/pdf"
      ],
      "changes": [
        "إضافة زر طباعة بعد البيع (في رسالة النجاح)",
        "إصلاح أزرار الطباعة في صفحة الفواتير (بعد Phase A)",
        "إضافة زر طباعة الملخص اليومي",
        "تحسين PDF (معلومات الضمان، التصميم)",
        "إضافة Loading states",
        "إضافة Error handling"
      ],
      "whyImportant": "الطباعة = 90% من استخدام الفواتير. البائع يحتاج طباعة سريعة وسهلة. PDF واضح = رضا العميل.",
      "riskIfNotDone": {
        "level": "high",
        "description": "صعوبة في الطباعة. وقت ضائع. عميل غاضب."
      },
      "tasks": [
        {
          "id": "F-1",
          "description": "إضافة زر طباعة بعد البيع (في رسالة النجاح)",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "F-2",
          "description": "إصلاح أزرار الطباعة في صفحة الفواتير - يعتمد على Phase A",
          "type": "frontend",
          "riskLevel": "high",
          "dependencies": ["Phase A"]
        },
        {
          "id": "F-3",
          "description": "إضافة زر طباعة الملخص اليومي (PDF)",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "F-4",
          "description": "تحسين PDF (معلومات الضمان واضحة، تصميم أفضل)",
          "type": "backend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "F-5",
          "description": "إضافة Loading states عند فتح PDF",
          "type": "frontend",
          "riskLevel": "low",
          "dependencies": []
        },
        {
          "id": "F-6",
          "description": "إضافة Error handling إذا فشل تحميل PDF",
          "type": "frontend",
          "riskLevel": "medium",
          "dependencies": []
        },
        {
          "id": "F-7",
          "description": "اختبار الطباعة في جميع السيناريوهات (بعد البيع، من الفواتير، الملخص)",
          "type": "testing",
          "riskLevel": "high",
          "dependencies": ["F-1", "F-2", "F-3", "F-4"]
        }
      ]
    }
  ],
  "executionOrder": [
    "Phase A",
    "Phase B",
    "Phase C",
    "Phase F",
    "Phase D",
    "Phase E"
  ],
  "notes": [
    "Phase A يجب أن يكون أولاً لأنه يصلح مشكلة حرجة",
    "Phase C و Phase F حرجيان للغاية ويؤثران مباشرة على عمل البائع",
    "Phase D و Phase E مهمان لكن يمكن تأجيلهما قليلاً",
    "جميع المراحل تعتمد على Phase A بشكل أو بآخر"
  ],
  "warnings": [
    "⚠️ لا تحذف صفحة /cashier/sales قبل التأكد من عدم وجود روابط أخرى تشير لها",
    "⚠️ تأكد من اختبار الصلاحيات بشكل كامل في Phase A",
    "⚠️ الحساب الذكي في Phase E مهم جداً - تأكد من استثناء الملغاة والمرتجعة بشكل صحيح",
    "⚠️ تحسين PDF قد يؤثر على المدير أيضاً - تأكد من عدم كسر أي شيء"
  ]
}

